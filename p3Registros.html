<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Registros</title>
	 <link href="estilo.css" rel="stylesheet" type="text/css">
	<script src="https://unpkg.com/vue@3"></script>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>
<body>
	<div id="contenedor">
		<h3>Hola, {{nombre}}</h3>
		<button @click ="action('a単adir',null)">A単adir</button>
		<table v-if="(inAction=='show')">
			<th>ID</th>
			<th>Nombre</th>
			<th>Username</th>
			<th>Email</th>
			<th>Acciones</th>
			<tr v-for="(item,index) in users">
				
				<td>{{item.id}}</td>
				
				<td >{{item.name}}</td>
			
				<td>{{item.username}}</td>
				
				<td>{{item.email}}</td>

				<td>
					<button @click ="action('editar',item,index)">Editar usuario</button>
					<button @click ="eliminar(index)">Eliminar usuario</button>
				</td>
			</tr>

		</table>

		<hr>
		<form v-if="(inAction=='')">
			<div class="form">
			<fieldset>
				<label>Nombre</label>
           
            <input type="text" v-model="name">
            <label>Username</label>
           
            <input type="text" v-model="username">
 			
            <label>Correo electronico</label>
           
            <input type="email" v-model="email">
 		
            <label>Password</label>
            <input type="password" v-model="password">
           
            
            <hr>
           	<label>Calle</label>
            <input type="text" v-model="street">

            <label>Suite</label>
            <input type="text" v-model="suite">

            <label>Ciudad</label>
            <input type="text" v-model="city">

            <label>Latitud</label>
            <input type="text" v-model="lat">

            <label>Longitud</label>
            <input type="text" v-model="lng">

            <hr>
            <label>Telefono</label>
            <input type="text" v-model="phone">

            <label>Website</label>
            <input type="text" v-model="website">

            <label>Nombre de compa単ia</label>
            <input type="text" v-model="company_name">

            <label>Catch Phrase</label>
            <input type="text" v-model="catchPhrase">

            <label>Estrategia de negocio</label>
            <input type="text" v-model="bs">
            <button @click ="guardar">Guardar</button>
            <button @click ="cancelar">Cancelar</button>
			</fieldset>
            
        </div>
		</form>
		

	</div>
	
	<script type="text/javascript">
		const { createApp } = Vue
        const data=null
        const error=null

        var test = createApp({
        data() {
            return {
                users:null,
                inAction:"show",
                nombre:sessionStorage.getItem("nombre"),
                name:"",
                username:"",
                email:"",
                password:"",
                street:"",
                suite:"",
                city:"",
                lat:"",
                lng:"",
                phone:"",
                website:"",
                company_name:"",
                catchPhrase:"",
                bs:"",
                id:0,
                act:true
                
            }
        },methods:{
        	action(m,u,i){
        		
				if(m=="a単adir"){
					this.act=false;
					this.inAction="";
					this.name="";
					this.username="";
					this.email="";
	                this.password="";
	                this.street="";
	                this.suite="";
	                this.city="";
	                this.lat="";
	                this.lng="";
	                this.phone="";
	                this.website="";
	                this.company_name="";
	                this.catchPhrase="";
	                this.bs="";
				}
				if (m=="editar") {
					this.id = i;
					console.log(i);
					console.log(u.name);
					this.name=this.users[i].name;
					this.username=this.users[i].username;
					this.email=this.users[i].email;
	                this.password=this.users[i].password;
	                this.street=this.users[i].address.street;
	                this.suite=this.users[i].address.suite;
	                this.city=this.users[i].address.city;
	                this.lat=this.users[i].address.geo.lat;
	                this.lng=this.users[i].address.geo.lng;
	                this.phone=this.users[i].phone;
	                this.website=this.users[i].website;
	                this.company_name=this.users[i].company.name;
	                this.catchPhrase=this.users[i].company.name;
	                this.bs=this.users[i].company.bs;
		            this.inAction="";	
					console.log(this.id);
				}
			},
			cancelar(){
				this.inAction="show";
			},guardar(i){

				 var iD = this.id;
				 var idU = this.users.length+1;
				 var nameU = this.name;
                 var usernameU = this.username;
                 var email_usuario = this.email;
                 var contra = this.password;
                 var streetU = this.street;
                 var suiteU = this.suite;
                 var cityU = this.city;
                 var latU = this.lat;
                 var lngU = this.lng;
                 var phoneU = this.phone;
                 var websiteU = this.website;
                 var nombreCompania = this.company_name;
                 var frase = this.catchPhrase;
                 var estrategia = this.bs;

				 if (this.act==true) {
				 	
				 	this.users[iD].name=nameU;
					this.users[iD].username=usernameU;
					this.users[iD].email=email_usuario;
	                this.users[iD].password=contra;
	                this.users[iD].street = streetU;
	               	this.users[iD].address.suite =suiteU;
	                this.users[iD].address.city=cityU;
	              	this.users[iD].address.geo.lat =latU;
	                this.users[iD].address.geo.lng=lngU;
	                this.users[iD].phone=phoneU;
	                this.users[iD].website=websiteU;
	                this.users[iD].company.name=nombreCompania;
	                this.users[iD].company.name=frase;
	                this.users[iD].company.bs=estrategia;
	                swal("Correcto", "Usuario actualizado correctamente", "success");
		            this.inAction="show";
		            
		           				
				 }else{
                 	
                 	this.users.push({id:idU,name:nameU,username:usernameU,email:email_usuario,password:contra,address:{street:streetU,suite:suiteU,city:cityU,lat:latU,lng:lngU},company:{phone:phoneU,website:websiteU,name:nombreCompania,catchPhrase:frase,bs:estrategia}});
                	 swal("Correcto", "Usuario registrado correctamente", "success");
                	 this.inAction="show";
                	 this.act=true;
				 }
				
                
			},

			eliminar(id){
				swal({
				  title: "Estas seguro?",
				  text: "Se eliminara el registro definitivamente",
				  icon: "warning",
				  buttons: true,
				  dangerMode: true,
				})
				.then((willDelete) => {
				  if (willDelete) {
				  	this.users.splice(id,1);
				    swal("El usuario ha sido eliminado correctamente", {
				      icon: "success",
				    });
				  } else {
				    swal("Se ha cancelado la eliminacion");
				  }
				});
            	
            }

        	},

        	mounted(){
            fetch('users.json')
            .then((res) => res.json())
            .then((json) => (this.users=json))
            .catch((err) => (console.log(err)))
        	}
    	}).mount('#contenedor')
		console.log(this.id);
	</script>
</body>
</html>